version: '3.8'

services:
  terraform-server:
    build: .
    container_name: terraform-main-server
    ports:
      - "8000:5000"
    volumes:
      - ./plugins:/app/plugins
      - ./data:/app/data
    environment:
      - PYTHONPATH=/app
    working_dir: /app
    command: python main.py
    restart: unless-stopped
    networks:
      - terraform-network

  error-aggregator:
    build: .
    ports:
      - "50051:50051"
    volumes:
      - ./plugins:/app/plugins
      - ./data:/app/data
    environment:
      - PYTHONPATH=/app
    working_dir: /app
    restart: unless-stopped
    networks:
      - terraform-network
    command: python plugins/error_aggregator.py

  security-scanner:
    build: .
    ports:
      - "50052:50052"
    environment:
      - PYTHONPATH=/app
    volumes:
      - ./plugins:/app/plugins
      - ./data:/app/data
    working_dir: /app
    restart: unless-stopped
    networks:
      - terraform-network
    command: python plugins/security_scanner.py

  performance-analyzer:
    build: .
    ports:
      - "50053:50053"
    volumes:
      - ./plugins:/app/plugins
      - ./data:/app/data
    environment:
      - PYTHONPATH=/app
    working_dir: /app
    restart: unless-stopped
    networks:
      - terraform-network
    command: python plugins/performance_analyzer.py
      
networks:
  terraform-network:
    driver: bridge

volumes:
  app_data: